<html>
<head>
    <style>
        .valid {
            color: #009900;
        }

        .fail {
            color: #990000;
        }
    </style>
</head>

<body>
<fieldset>
    <legend>Color evaluation</legend>
    <label for="foreground">Foreground (hex)<input id="foreground" onchange="setColor(this.value, 'foreInput')"
                                                   value="#0000FF"/></label>
    <input type="color" id="foreInput" onchange="setColor(this.value, 'foreground')" value="#0000FF"/><br/>
    <label for="background">Background (hex)<input id="background" onchange="setColor(this.value, 'backInput')"
                                                   value="#BFBFBF"/></label>
    <input type="color" id="backInput" onchange="setColor(this.value, 'background')" value="#BFBFBF"/><br/>

    <table>
        <caption>Results</caption>
        <thead>
        <tr>
            <th>Color mode</th>
            <th>Foreground</th>
            <th>Backgroud</th>
            <th>Contrast</th>
            <th>Brightness</th>
            <th>Color diff</th>
        </tr>
        </thead>
        <tbdy>
            <tr>
                <th>hex</th>
                <td id="foreHex"></td>
                <td id="backHex"></td>
                <td class="contrast"></td>
                <td class="brightness"></td>
                <td class="colorDifference"></td>
            </tr>
            <tr>
                <th>rgb</th>
                <td id="foreRGB"></td>
                <td id="backRGB"></td>
                <td class="contrast"></td>
                <td class="brightness"></td>
                <td class="colorDifference"></td>
            </tr>
        </tbdy>
    </table>
    <table>
        <thead>
        <tr>
            <th>Size</th>
            <th>Contrast ratio</th>
            <th>AA</th>
            <th>AAA</th>
            <th>example</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>Normal</td>
            <td class="contrast"></td>
            <td id="normalAA"></td>
            <td id="normalAAA"></td>
            <td class="sampleText normal" style="font-size: 14pt">Lorem ipsum</td>
        </tr>
        <tr>
            <td>Large</td>
            <td class="contrast"></td>
            <td id="largeAA"></td>
            <td id="largeAAA"></td>
            <td class="sampleText large" style="font-size: 18pt">Lorem ipsum</td>
        </tr>
        </tbody>
    </table>
</fieldset>
<ul id="results"></ul>
<script src="wcagContrastChecker.js"></script>
<script>
    evaluateColors();
    evaluateAllElements();

    function evaluateAllElements() {
        var tags, elements, validation, elementsByValue, elementsByTag, item, itemContent, resultStrings, label, fontSize,
            isValidAA, isValidAAA,
            sublist, elementItem, counter,
            results = checkAllElementsInDocument(),
            resultsList = document.getElementById('results');

        for (resultLabel in results) {
            resultStrings = resultLabel.split('-');
            label = resultStrings[0];
            fontSize = resultStrings[1];

            elements = results[resultLabel].elements;
            validation = results[resultLabel].validation;

            isValidAA = validation.isValidAA;
            isValidAAA = validation.isValidAAA;

            item = document.createElement('li');
            sublist = createElement('ul');

            counter = 0;
            tags = [];
            elementsByValue = [];
            for (tag in elements) {
                tags.push(tag);
                elementsByTag = elements[tag];
                elementsByValue = elementsByValue.concat(elementsByTag);
                counter += elementsByTag.length;

                elementItem = createElement('li', tag + ' (x' + elementsByTag.length +')', {tabindex: 0});
                elementItem.addEventListener('focus', highlightElements(elementsByTag));
                elementItem.addEventListener('blur', removeHighlightFromElements(elementsByTag));
                sublist.appendChild(elementItem)
            }

            itemContent = label + ' - ' + fontSize + ' - ' + isValidAA + ' - ' + isValidAAA + ' (' + counter + ' elements [' + tags.join(', ') + '])';
            item = createElement('li', itemContent, {tabindex: 0});


            item.addEventListener('focus', highlightElements(elementsByValue));
            item.addEventListener('blur', removeHighlightFromElements(elementsByValue));

            if(sublist.childNodes.length > 1){
                item.appendChild(sublist)
            }

            resultsList.appendChild(item);
        }

        function highlightElements(elements) {
            return function () {
                elements.forEach(function (element) {
                    element.style.outline = '1px solid red';
                });
            }
        }

        function removeHighlightFromElements(elements) {
            return function () {
                elements.forEach(function (element) {
                    element.style.outline = '';
                });
            }
        }

    }

    function setColor(color, id) {
        document.getElementById(id).value = color;
        evaluateColors();
    }

    function evaluateColors() {
        var foregroundColor = document.getElementById('foreground').value,
            backgroundColor = document.getElementById('background').value,
            foreHex = document.getElementById('foreHex'),
            foreRGB = document.getElementById('foreRGB'),
            backHex = document.getElementById('backHex'),
            backRGB = document.getElementById('backRGB'),
            foreInput = document.getElementById('foreInput'),
            backInput = document.getElementById('backInput'),
            contrast = document.querySelectorAll('.contrast'),
            brightness = document.querySelectorAll('.brightness'),
            colorDifference = document.querySelectorAll('.colorDifference'),
            foreRGBObject = hexToRGB(foregroundColor),
            backRGBObject = hexToRGB(backgroundColor),
            examples = document.querySelectorAll('.sampleText'),
            contrastDiff = getContrastDiff(foreRGBObject, backRGBObject),
            brightnessDiff = getBrightnessDiff(foreRGBObject, backRGBObject),
            colorDiff = getColorDiff(foreRGBObject, backRGBObject),
            validationNormal, validationLarge;

        foreInput.value = shorthandHexToExtended(foregroundColor);
        backInput.value = shorthandHexToExtended(backgroundColor);

        foreHex.innerText = foregroundColor;
        foreRGB.innerText = 'rgb(' + foreRGBObject.r + ',' + foreRGBObject.g + ',' + foreRGBObject.b + ')';
        backHex.innerText = backgroundColor;
        backRGB.innerText = 'rgb(' + backRGBObject.r + ',' + backRGBObject.g + ',' + backRGBObject.b + ')';

        contrast.forEach(function (element) {
            element.innerText = contrastDiff + ':1';
        });
        brightness.forEach(function (element) {
            element.innerText = brightnessDiff;
        });
        colorDifference.forEach(function (element) {
            element.innerText = colorDiff;
        });
        examples.forEach(function (element) {
            element.style.color = foregroundColor;
            element.style.backgroundColor = backgroundColor;
        });

        validationNormal = evaluateColorFromElement(document.querySelectorAll('.normal')[0]);
        validationLarge = evaluateColorFromElement(document.querySelectorAll('.large')[0]);


        document.getElementById('normalAA').className = validationNormal.isValidAA ? 'valid' : 'fail';
        document.getElementById('normalAA').innerText = validationNormal.isValidAA ? 'Pass' : 'Fail';
        document.getElementById('normalAAA').className = validationNormal.isValidAAA ? 'valid' : 'fail';
        document.getElementById('normalAAA').innerText = validationNormal.isValidAAA ? 'Pass' : 'Fail';
        document.getElementById('largeAA').className = validationLarge.isValidAA ? 'valid' : 'fail';
        document.getElementById('largeAA').innerText = validationLarge.isValidAA ? 'Pass' : 'Fail';
        document.getElementById('largeAAA').className = validationLarge.isValidAAA ? 'valid' : 'fail';
        document.getElementById('largeAAA').innerText = validationLarge.isValidAAA ? 'Pass' : 'Fail';
    }
</script>
</body>
</html>